<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>网络日记</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="记录美好生活">
<meta property="og:type" content="website">
<meta property="og:title" content="网络日记">
<meta property="og:url" content="https://xiangrenya.github.io/index.html">
<meta property="og:site_name" content="网络日记">
<meta property="og:description" content="记录美好生活">
<meta property="og:locale">
<meta property="article:author" content="Allen">
<meta property="article:tag" content="前端 html5 css3 javascript node react vue">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="网络日记" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">网络日记</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">写字的地方</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://xiangrenya.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Selenium 实现 Web UI 自动化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/15/Selenium%20%E5%AE%9E%E7%8E%B0%20Web%20UI%20%E8%87%AA%E5%8A%A8%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2020-04-14T16:00:00.000Z" itemprop="datePublished">2020-04-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96/">自动化</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/15/Selenium%20%E5%AE%9E%E7%8E%B0%20Web%20UI%20%E8%87%AA%E5%8A%A8%E5%8C%96/">Selenium 实现 Web UI 自动化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>由于经常需要登录公司的租户平台导入多语言，以及排查一些 web 页面的问题，每次都要输入不同的账号等等这些人肉且频繁无脑的操作，直到我看到 selenium 之后，这一切发生了改观，可以通过 python3 + selenium3，来实现部分 web ui 的自动化，提高了做事的效率。</p>
<h2 id="安装-selenium"><a href="#安装-selenium" class="headerlink" title="安装 selenium"></a>安装 selenium</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install selenium</span><br></pre></td></tr></table></figure>

<p>如果在安装过程中遇到网络连接异常的问题，可以看我之前写的一篇文章：<a href="%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E8%AE%BE%E7%BD%AE%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.md">命令行工具设置网络代理</a></p>
<h2 id="下载-chrome-浏览器驱动"><a href="#下载-chrome-浏览器驱动" class="headerlink" title="下载 chrome 浏览器驱动"></a>下载 chrome 浏览器驱动</h2><p>一般平时使用 chrome 浏览器，所以下载 chrome 浏览器驱动，下载地址：<a target="_blank" rel="noopener" href="http://chromedriver.chromium.org/">http://chromedriver.chromium.org</a></p>
<p>解压到 c 盘，路径为 <code>C:\chromedriver_win32\chromedriver.exe</code>，同时要记得将 <code>C:\chromedriver_win32</code> 路径加入到系统路径下，找到 电脑 &gt; 属性 &gt; 高级系统设置 &gt; 环境变量 &gt; 系统变量 &gt; Path，然后添加 <code>C:\chromedriver_win32</code></p>
<h2 id="创建浏览器驱动对象"><a href="#创建浏览器驱动对象" class="headerlink" title="创建浏览器驱动对象"></a>创建浏览器驱动对象</h2><p>最简单的创建浏览器 driver，如下所示</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">driver = webdriver.Chrome()</span><br></pre></td></tr></table></figure>

<p>由于现在主流的网站项目，都是前后端分离，部分元素是需要等待接口返回，异步加载后渲染的，所以会出现无法及时定位到元素的情况，我们可以通过隐式等待的方法，作用于整个 driver 的生命周期，如下代码示例，当第一次无法定位到指定元素时，driver 会等待 5s，如果 5s 后，还是没有找到该元素，才会抛出错误。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.implicitly_wait(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>每次通过 driver 打开浏览器，都是页面顶部出现一个提示：Chrome正受到自动软件测试的控制，这个提示遮挡了页面的可视区域，我们可以通过配置 chrome_options 把这个提示去掉</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">option = webdriver.ChromeOptions()</span><br><span class="line">option.add_experimental_option(<span class="string">&#x27;useAutomationExtension&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">option.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">driver = webdriver.Chrome(chrome_options=option)</span><br></pre></td></tr></table></figure>

<p>在运行 python 脚本结束后，浏览器 driver 会自动关闭，后来发现是由于变量 driver 是被定义在函数里，当该函数执行完，里面的变量会被销毁，所以函数内 driver 也不存在，所以浏览器会自动退出，所以如果希望脚本执行完，浏览器保持不退出，可以将 driver 定义全局变量里。</p>
<p>最完整创建浏览器 driver，如下所示</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_driver</span>():</span></span><br><span class="line">    option = webdriver.ChromeOptions()</span><br><span class="line">    option.add_experimental_option(<span class="string">&#x27;useAutomationExtension&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">    option.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">    driver = webdriver.Chrome(chrome_options=option)</span><br><span class="line">    driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line">    driver.maximize_window()</span><br><span class="line">    <span class="keyword">return</span> driver</span><br><span class="line">driver = get_driver()</span><br></pre></td></tr></table></figure>

<h2 id="用户登录实战"><a href="#用户登录实战" class="headerlink" title="用户登录实战"></a>用户登录实战</h2><p>下面来一个简单的网站登录的实战过程，代码示例如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">driver, url, username, password</span>):</span></span><br><span class="line">    driver.get(url)</span><br><span class="line">    driver.find_element_by_css_selector(<span class="string">&#x27;#username&#x27;</span>).send_keys(username)</span><br><span class="line">    driver.find_element_by_css_selector(<span class="string">&#x27;#password&#x27;</span>).send_keys(password)</span><br><span class="line">    driver.find_element_by_css_selector(<span class="string">&#x27;#login&#x27;</span>).click()</span><br><span class="line">driver = get_driver()</span><br><span class="line">login(driver, <span class="string">&#x27;https://xxx.com/login.html&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://xiangrenya.github.io/2020/04/15/Selenium%20%E5%AE%9E%E7%8E%B0%20Web%20UI%20%E8%87%AA%E5%8A%A8%E5%8C%96/" data-id="ckogpfhdv0000kl9fb5xa4f6h" data-title="Selenium 实现 Web UI 自动化" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/selenium/" rel="tag">selenium</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Python 自动上传 CDN 资源到 OSS Bucket" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/15/Python%20%E8%87%AA%E5%8A%A8%E4%B8%8A%E4%BC%A0%20CDN%20%E8%B5%84%E6%BA%90%E5%88%B0%20OSS%20Bucket/" class="article-date">
  <time class="dt-published" datetime="2020-04-14T16:00:00.000Z" itemprop="datePublished">2020-04-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/15/Python%20%E8%87%AA%E5%8A%A8%E4%B8%8A%E4%BC%A0%20CDN%20%E8%B5%84%E6%BA%90%E5%88%B0%20OSS%20Bucket/">Python 自动上传 CDN 资源到 OSS Bucket</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最初是使用 OSS-Browser 客户端上传前端静态资源到 OSS Bucket 里的，需要针对不同的环境，上传不同的静态资源到 OSS Bucket，每次都要切换账号，非常的笨拙机械，同时也无法也加入到自动化流程里，所以才有了这篇文章。</p>
<p><img src="/assets/images/oss-browser.png" alt="oss-browser.png"></p>
<h2 id="安装-oss2"><a href="#安装-oss2" class="headerlink" title="安装 oss2"></a>安装 oss2</h2><p>通过 pip 工具安装 oss2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install oss2</span><br></pre></td></tr></table></figure>

<h2 id="授权认证"><a href="#授权认证" class="headerlink" title="授权认证"></a>授权认证</h2><p>通过 <code>oss2.Auth</code> 方法进行授权认证</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">access_key_id = <span class="string">&#x27;6MKOqxGiGU4AUk44&#x27;</span></span><br><span class="line">access_key_secret = <span class="string">&#x27;ufu7nS8kS59awNihtjSonMETLI0KLy&#x27;</span></span><br><span class="line">auth = oss2.Auth(access_key_id, access_key_secret)</span><br></pre></td></tr></table></figure>

<h2 id="获取-bucket-对象"><a href="#获取-bucket-对象" class="headerlink" title="获取 bucket 对象"></a>获取 bucket 对象</h2><p>通过 <code>oss2.Bucket</code> 方法获取 bucket 对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">endpoint = <span class="string">&#x27;https://oss-cn-shanghai.aliyuncs.com&#x27;</span></span><br><span class="line">bucket_name = <span class="string">&#x27;static&#x27;</span></span><br><span class="line">bucket = oss2.Bucket(auth, endpoint, bucket_name)</span><br></pre></td></tr></table></figure>

<h2 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h2><p>通过 <code> bucket.put_object_from_file</code> 方法上传本地文件到 OSS Bucket 里</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&#x27;/v1.0.0/index.html&#x27;</span></span><br><span class="line">filename = <span class="string">r&#x27;D:\project\index.html&#x27;</span></span><br><span class="line">bucket.put_object_from_file(key, filename)</span><br></pre></td></tr></table></figure>

<h2 id="判断文件是否存在"><a href="#判断文件是否存在" class="headerlink" title="判断文件是否存在"></a>判断文件是否存在</h2><p>通过 <code>bucket.object_exists</code> 方法判断 OSS Bucket 是否已经存在相关资源。在上传文件之前，最好验证一下 key 是否存在，避免误操作，覆盖已有的线上资源，造成线上事故</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&#x27;/v1.0.0&#x27;</span></span><br><span class="line">bucket.object_exists(key)</span><br></pre></td></tr></table></figure>

<h2 id="整体实现"><a href="#整体实现" class="headerlink" title="整体实现"></a>整体实现</h2><p>封装获取 OSS Bucket 对象的方法，根据不同的环境，返回不同 bucket 对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_bucket</span>(<span class="params">env</span>):</span></span><br><span class="line">    endpoint = <span class="string">&#x27;https://oss-cn-shanghai.aliyuncs.com&#x27;</span></span><br><span class="line">    env_bucket = &#123;</span><br><span class="line">        <span class="string">&#x27;dev&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;access_key_id&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;access_key_secret&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;bucket_name&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;prod&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;access_key_id&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;access_key_secret&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;bucket_name&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    auth = oss2.Auth(env_bucket[env][<span class="string">&#x27;access_key_id&#x27;</span>], env_bucket[env][<span class="string">&#x27;access_key_secret&#x27;</span>])</span><br><span class="line">    bucket = oss2.Bucket(auth, endpoint, env_bucket[env][<span class="string">&#x27;bucket_name&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> bucket</span><br></pre></td></tr></table></figure>

<p>批量上传本地前端资源到 OSS Bucket 里</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    env = <span class="string">&#x27;dev&#x27;</span></span><br><span class="line">    version = <span class="string">&#x27;v1.0.0&#x27;</span></span><br><span class="line">    source_folder = <span class="string">r&#x27;D:\project&#x27;</span></span><br><span class="line">    bucket = get_bucket(env)</span><br><span class="line">    dest_folder = <span class="string">&#x27;static/%s&#x27;</span> % version</span><br><span class="line">    <span class="keyword">if</span> bucket.object_exists(dest_folder):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s 已存在，不可以重复上传文件&#x27;</span> % dest_folder)</span><br><span class="line">        exit()</span><br><span class="line">    files = os.listdir(source_folder)</span><br><span class="line">    total = <span class="built_in">len</span>(files)</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        key = dest_folder + <span class="string">&#x27;/&#x27;</span> + file</span><br><span class="line">        filename = source_folder + <span class="string">&#x27;\\&#x27;</span> + file</span><br><span class="line">        bucket.put_object_from_file(key, filename)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#123;0&#125; [&#123;1&#125;/&#123;2&#125;]&#x27;</span>.<span class="built_in">format</span>(file, count, total))</span><br></pre></td></tr></table></figure>

<p>通过 <code>os.listdir</code> 列出源目录下的文件列表，通过 <code>count</code> 和 <code>total</code> 来观察前端静态资源的上传进度。</p>
<p>参考资料</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://help.aliyun.com/product/31815.html?spm=a2c4g.11174283.6.540.391f7da2Rpvw7Q">对象存储 OSS</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/aliyun/aliyun-oss-python-sdk">aliyun-oss-python-sdk</a></li>
<li><a target="_blank" rel="noopener" href="https://aliyun-oss-python-sdk.readthedocs.io/en/latest/api.html#">oss2 接口文档</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xiangrenya.github.io/2020/04/15/Python%20%E8%87%AA%E5%8A%A8%E4%B8%8A%E4%BC%A0%20CDN%20%E8%B5%84%E6%BA%90%E5%88%B0%20OSS%20Bucket/" data-id="ckogpfhe10001kl9f2yvz9rs7" data-title="Python 自动上传 CDN 资源到 OSS Bucket" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oss/" rel="tag">oss</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-武装你的终端 Terminal" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/15/%E6%AD%A6%E8%A3%85%E4%BD%A0%E7%9A%84%E7%BB%88%E7%AB%AF%20Terminal/" class="article-date">
  <time class="dt-published" datetime="2020-04-14T16:00:00.000Z" itemprop="datePublished">2020-04-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/15/%E6%AD%A6%E8%A3%85%E4%BD%A0%E7%9A%84%E7%BB%88%E7%AB%AF%20Terminal/">武装你的终端 Terminal</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>通过 <code>zsh</code> 和 <code>oh-my-zsh</code> 来提升终端 <code>Terminal</code> 的工作效率，社区拥有丰富的插件，精美的主题，让你从此爱上使用命令行工具，小伙伴们一起来体验吧！</p>
<h2 id="安装-zsh"><a href="#安装-zsh" class="headerlink" title="安装 zsh"></a>安装 zsh</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install zsh</span><br></pre></td></tr></table></figure>

<h2 id="安装-oh-my-zsh"><a href="#安装-oh-my-zsh" class="headerlink" title="安装 oh-my-zsh"></a>安装 <code>oh-my-zsh</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c &quot;$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)&quot;</span><br></pre></td></tr></table></figure>

<h2 id="安装-autojump-插件"><a href="#安装-autojump-插件" class="headerlink" title="安装 autojump 插件"></a>安装 autojump 插件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone git://github.com/joelthelion/autojump.git</span><br><span class="line">cd autojump</span><br><span class="line">./install.py</span><br></pre></td></tr></table></figure>

<h2 id="安装-zsh-autosuggestions-插件"><a href="#安装-zsh-autosuggestions-插件" class="headerlink" title="安装 zsh-autosuggestions 插件"></a>安装 zsh-autosuggestions 插件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure>

<h2 id="安装-zsh-syntax-highlighting-插件"><a href="#安装-zsh-syntax-highlighting-插件" class="headerlink" title="安装 zsh-syntax-highlighting 插件"></a>安装 zsh-syntax-highlighting 插件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git://github.com/zsh-users/zsh-syntax-highlighting $ZSH_CUSTOM/plugins/zsh-syntax-highlighting</span><br></pre></td></tr></table></figure>

<h2 id="设置主题"><a href="#设置主题" class="headerlink" title="设置主题"></a>设置主题</h2><p>通过配置文件 <code>.zshrc</code>，来配置前面安装的插件，可以设置主题为 <code>random</code>，这样每次打开终端会话，都会有惊喜哦。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br><span class="line">plugins=(autojump zsh-autosuggestions zsh-syntax-highlighting)</span><br><span class="line">ZSH_THEME=&quot;random&quot;</span><br></pre></td></tr></table></figure>

<h2 id="生效配置"><a href="#生效配置" class="headerlink" title="生效配置"></a>生效配置</h2><p>通过  <code>source</code> 命令，立即生效配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure>

<h2 id="升级、卸载-oh-my-zsh"><a href="#升级、卸载-oh-my-zsh" class="headerlink" title="升级、卸载 oh-my-zsh"></a>升级、卸载 <code>oh-my-zsh</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">upgrade_oh_my_zsh</span><br><span class="line">uninstall_oh_my_zsh</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://xiangrenya.github.io/2020/04/15/%E6%AD%A6%E8%A3%85%E4%BD%A0%E7%9A%84%E7%BB%88%E7%AB%AF%20Terminal/" data-id="ckogpfhea000hkl9fb8t4hbe2" data-title="武装你的终端 Terminal" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/terminal/" rel="tag">terminal</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-常用的 SQL 语句" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/14/%E5%B8%B8%E7%94%A8%E7%9A%84%20SQL%20%E8%AF%AD%E5%8F%A5/" class="article-date">
  <time class="dt-published" datetime="2020-04-13T16:00:00.000Z" itemprop="datePublished">2020-04-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/14/%E5%B8%B8%E7%94%A8%E7%9A%84%20SQL%20%E8%AF%AD%E5%8F%A5/">常用的 SQL 语句</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>下面整理记录的一些常用的 MySQL 数据库操作语句，方便回顾和查阅。</p>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE db_name;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE db_name;</span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line">USE db_name;</span><br><span class="line"><span class="keyword">DROP</span> DATABASE db_name;</span><br></pre></td></tr></table></figure>

<h2 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tb_name (</span><br><span class="line">  id TINYINT UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">60</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  score TINYINT UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="keyword">DEFAULT</span> charset <span class="operator">=</span> utf8;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tb_name;</span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"><span class="keyword">DESCRIBE</span> tb_name;</span><br><span class="line"><span class="comment">-- show table status vertically</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;tb_name&#x27;</span>\G;</span><br><span class="line"><span class="comment">-- rename</span></span><br><span class="line">RENAME <span class="keyword">TABLE</span> tb_name <span class="keyword">TO</span> new_tb_name</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name RENAME new_tb_name;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> tb_name;</span><br></pre></td></tr></table></figure>

<h2 id="列操作"><a href="#列操作" class="headerlink" title="列操作"></a>列操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- show columns，equal describe tb_name</span></span><br><span class="line"><span class="keyword">SHOW</span> COLUMNS <span class="keyword">FROM</span> tb_name;</span><br><span class="line"><span class="comment">-- edit column</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name <span class="keyword">ADD</span> col_name <span class="type">VARCHAR</span>(<span class="number">80</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name MODIFY col_name <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name CHANGE col_name new_col_name <span class="type">SMALLINT</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name <span class="keyword">ALTER</span> col_name <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name <span class="keyword">DROP</span> col_name;</span><br><span class="line"><span class="comment">-- primary key</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY(col_name);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br><span class="line"><span class="comment">-- foreign key</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_name <span class="keyword">FOREIGN</span> KEY (col_name) <span class="keyword">REFERENCES</span> tb2_name(col_name);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY fk_name;</span><br><span class="line"><span class="comment">-- index</span></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">UNIQUE</span>] INDEX idx_name <span class="keyword">ON</span> tb_name(col_name);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_name <span class="keyword">DROP</span> INDEX idx_name;</span><br></pre></td></tr></table></figure>

<h2 id="权限操作"><a href="#权限操作" class="headerlink" title="权限操作"></a>权限操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- change password</span></span><br><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="operator">=</span> PASSWORD(<span class="string">&#x27;newpassword&#x27;</span>);</span><br><span class="line"><span class="comment">-- create user and grant privileges</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, UPDATE, <span class="keyword">DELETE</span>, <span class="keyword">CREATE</span>, INDEX, <span class="keyword">ALTER</span>, <span class="keyword">DROP</span> <span class="keyword">ON</span> db_name.tb_name IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"><span class="comment">-- revoke privileges</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span>, <span class="keyword">GRANT</span> <span class="keyword">ON</span> db_name.tb_name <span class="keyword">FROM</span> user_name;</span><br><span class="line"><span class="comment">-- show privileges</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> user_name;</span><br></pre></td></tr></table></figure>


<h2 id="增删查改"><a href="#增删查改" class="headerlink" title="增删查改"></a>增删查改</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- select</span></span><br><span class="line"><span class="keyword">SELECT</span> col1, col2 <span class="keyword">FROM</span> tb_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> col1, col2 <span class="keyword">FROM</span> tb_name;</span><br><span class="line"><span class="comment">-- null</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name <span class="keyword">WHERE</span> col1 <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name <span class="keyword">WHERE</span> col1 <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="comment">-- order</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name <span class="keyword">WHERE</span> col1 <span class="operator">=</span> val1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> col2 <span class="keyword">ASC</span>, col3 <span class="keyword">DESC</span>;</span><br><span class="line"><span class="comment">-- pagination</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name LIMIT <span class="number">10</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name LIMIT <span class="number">0</span>, <span class="number">10</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name LIMIT <span class="number">10</span> <span class="keyword">OFFSET</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">-- like</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name <span class="keyword">WHERE</span> col1 <span class="keyword">LIKE</span> <span class="string">&#x27;abc%&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name <span class="keyword">WHERE</span> col1 <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;_abc&#x27;</span>;</span><br><span class="line"><span class="comment">-- in</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name <span class="keyword">WHERE</span> col1 <span class="keyword">IN</span> (val1, val2, val3);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name <span class="keyword">WHERE</span> col1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> col1 <span class="keyword">FROM</span> tb2_name);</span><br><span class="line"><span class="comment">-- between</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name <span class="keyword">WHERE</span> col1 <span class="keyword">BETWEEN</span> val1 <span class="keyword">AND</span> val2;</span><br><span class="line"><span class="comment">-- group</span></span><br><span class="line"><span class="keyword">SELECT</span> col1, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">FROM</span> tb_name <span class="keyword">GROUP</span> <span class="keyword">BY</span> col1 <span class="keyword">HAVING</span> total <span class="operator">&gt;</span> <span class="number">10</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> total;</span><br><span class="line"><span class="comment">-- exisit</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb1_name <span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb2_name <span class="keyword">WHERE</span> col1 <span class="operator">=</span> tb1_name.col1 <span class="keyword">AND</span> col2 <span class="operator">&lt;</span> val2);</span><br><span class="line"><span class="comment">-- join</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb1_name t1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> tb2_name t2 <span class="keyword">ON</span> t1.col1 <span class="operator">=</span> t2.col1;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb1_name t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb2_name t2 <span class="keyword">ON</span> t1.col1 <span class="operator">=</span> t2.col1;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb1_name t1 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> tb2_name t2 <span class="keyword">ON</span> t1.col1 <span class="operator">=</span> t2.col1;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_name t1, tb_name t2 <span class="keyword">WHERE</span> t1.col1 <span class="operator">=</span> t2.col1 <span class="keyword">AND</span> t1.col2 <span class="operator">!=</span> t2.col2;</span><br><span class="line"><span class="comment">-- aggregate functions</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(col1) <span class="keyword">FROM</span> tb_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(col1) <span class="keyword">FROM</span> tb_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(col1) <span class="keyword">FROM</span> tb_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(col1) <span class="keyword">FROM</span> tb_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> tb_name;</span><br><span class="line"><span class="comment">-- count like all aggregate functions, it does not count null as a distinct value</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(col1) <span class="keyword">FROM</span> tb_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> col1, col2) <span class="keyword">FROM</span> tb_name;</span><br><span class="line"><span class="comment">-- insert</span></span><br><span class="line">INSER <span class="keyword">INTO</span> tb1_name (col1, col2, col3) <span class="keyword">VALUES</span>(val1, val2, val3);</span><br><span class="line">INSER <span class="keyword">INTO</span> tb1_name (col1, col2, col3) <span class="keyword">VALUES</span>(val1, val2, val3), (val4, val5, val6), (val7, val8, val9);</span><br><span class="line"><span class="comment">-- update</span></span><br><span class="line">UPDATE tb_name <span class="keyword">SET</span> col1 <span class="operator">=</span> val1, col2 <span class="operator">=</span> val2 <span class="keyword">WHERE</span> col1 <span class="operator">=</span> val1;</span><br><span class="line"><span class="comment">-- delete</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> tb_name <span class="keyword">WHERE</span> col1 <span class="operator">=</span> val1;</span><br></pre></td></tr></table></figure>

<h2 id="管理操作"><a href="#管理操作" class="headerlink" title="管理操作"></a>管理操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">USE information_schema</span><br><span class="line"><span class="comment">-- db size</span></span><br><span class="line"><span class="keyword">SELECT</span> TABLE_SCHEMA, ROUND(<span class="built_in">SUM</span>(DATA_LENGTH<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>), <span class="number">2</span>) <span class="keyword">as</span> SIZE_MB <span class="keyword">FROM</span> TABLES <span class="keyword">GROUP</span> <span class="keyword">BY</span> TABLE_SCHEMA <span class="keyword">ORDER</span> <span class="keyword">BY</span> SIZE_MB <span class="keyword">DESC</span>;</span><br><span class="line"><span class="comment">--- table size</span></span><br><span class="line"><span class="keyword">SELECT</span> TABLE_NAME, DATA_LENGTH <span class="operator">+</span> INDEX_LENGTH, TABLE_ROWS, ROUND((DATA_LENGTH <span class="operator">+</span> INDEX_LENGTH)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>, <span class="number">2</span>) <span class="keyword">as</span> SIZE_MB <span class="keyword">FROM</span> TABLES <span class="keyword">WHERE</span> TABLE_SCHEMA<span class="operator">=</span><span class="string">&#x27;tb_name&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> SIZE_MB;</span><br></pre></td></tr></table></figure>

<p>注意：如果密码中带有小数点，如 <code>abc.123</code>，在命令行中输入密码 <code>-p[password]</code> 时，需要给密码加个单引号，即 <code>-p&#39;abc.123&#39;</code>, 而不是 <code>-pabc.123</code>，这样会出错。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mysql status</span></span><br><span class="line">SHOW STATUS;</span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql variables</span></span><br><span class="line">SHOW VARIABLES</span><br><span class="line"><span class="meta">#</span><span class="bash"> import</span></span><br><span class="line">mysql -h host -u root -p[password] [-D] db_name &lt; file.sql</span><br><span class="line"><span class="meta">#</span><span class="bash"> backup</span></span><br><span class="line">mysqldumb -h host -u user_name -p[password] -v --databases db_name &gt; dump.sql</span><br><span class="line"><span class="meta">#</span><span class="bash"> fix: A dump made using PowerShell on Windows with output redirection creates a file that has UTF-16 encoding:</span></span><br><span class="line">mysqldumb -h host -u user_name -p[password] -v --databases db_name --result-file=dump.sql</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://xiangrenya.github.io/2020/04/14/%E5%B8%B8%E7%94%A8%E7%9A%84%20SQL%20%E8%AF%AD%E5%8F%A5/" data-id="ckogpfhe7000bkl9fh8vz3joj" data-title="常用的 SQL 语句" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Windows 系统下远程桌面连接 CentOS 7 系统" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/13/Windows%20%E7%B3%BB%E7%BB%9F%E4%B8%8B%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5%20CentOS%207%20%E7%B3%BB%E7%BB%9F/" class="article-date">
  <time class="dt-published" datetime="2020-04-12T16:00:00.000Z" itemprop="datePublished">2020-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/13/Windows%20%E7%B3%BB%E7%BB%9F%E4%B8%8B%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5%20CentOS%207%20%E7%B3%BB%E7%BB%9F/">Windows 系统下远程桌面连接 CentOS 7 系统</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>为了能够使用 Windows 系统自带的 RDP（Remote Desktop Protocol）客户端远程桌面连接 CentOS 7 的图形化界面，需要在 CentOS 7 系统上安装一个叫做 xrdp 的软件。</p>
<p>默认 yum 源是不包含的 xrdp 软件的，我们需要安装第三方 EPEL 软件源，EPEL 的全称是 Extra Packages for Enterprise Linux，企业版 Linux 附加软件包，这一软件包被包括在 CentOS 的 Extras 仓库中，并且默认启用。</p>
<h2 id="安装-EPEL-软件源"><a href="#安装-EPEL-软件源" class="headerlink" title="安装 EPEL 软件源"></a>安装 EPEL 软件源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br></pre></td></tr></table></figure>

<p>有兴趣的话，大家可以到 <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/epel/7/x86_64/Packages/">清华大学开源软件镜像站 EPEL 软件源</a> 网站下查看 EPEL 源到底有哪些软件。</p>
<h2 id="安装-xrdp"><a href="#安装-xrdp" class="headerlink" title="安装 xrdp"></a>安装 xrdp</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install xrdp</span><br></pre></td></tr></table></figure>

<h2 id="管理-xrdp-服务"><a href="#管理-xrdp-服务" class="headerlink" title="管理 xrdp 服务"></a>管理 xrdp 服务</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 启动 xrdp 服务</span><br><span class="line">systemctl start xrdp</span><br><span class="line"># 停止 xrdp 服务</span><br><span class="line">systemctl stop xrdp</span><br><span class="line"># 开机自启动 xrdp 服务</span><br><span class="line">systemctl enable xrdp</span><br></pre></td></tr></table></figure>

<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p>服务启动后，就可以使用 Windows 系统自带的远程桌面连接工具，输入 CentOS 7 主机的 ip 地址，端口默认是 3389，然后输入 CentOS 7 中的用户名和密码，就可以成功登录访问了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xiangrenya.github.io/2020/04/13/Windows%20%E7%B3%BB%E7%BB%9F%E4%B8%8B%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5%20CentOS%207%20%E7%B3%BB%E7%BB%9F/" data-id="ckogpfhe50004kl9fcbtb8xpi" data-title="Windows 系统下远程桌面连接 CentOS 7 系统" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/centos/" rel="tag">centos</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-命令行工具设置网络代理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/12/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E8%AE%BE%E7%BD%AE%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2020-04-11T16:00:00.000Z" itemprop="datePublished">2020-04-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/12/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E8%AE%BE%E7%BD%AE%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/">命令行工具设置网络代理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>今天在命令行工具 cmd 中，使用 <code>pip install selenium</code> 安装自动化 UI 测试框架的时候，出现连接超时的问题 。由于国内网络限制，访问国外的资源不稳定，需要在有机场的前提下，然后给 cmd 设置网络代理。</p>
<h2 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set http_proxy=http://127.0.0.1:1080</span><br><span class="line">set https_proxy=http://127.0.0.1:1080</span><br></pre></td></tr></table></figure>

<p>上面的变量设置，不是系统环境变量，只对当前 cmd 窗口上下文有效，所以，我们只需要在运行  <code>pip install selenium</code> 命令之前设置下 http_proxy 变量。</p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>通过 <code>curl</code> 工具连接 google，来验证是否能正常代理。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://www.google.com</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://xiangrenya.github.io/2020/04/12/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E8%AE%BE%E7%BD%AE%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/" data-id="ckogpfhe60006kl9fcsxh8mw7" data-title="命令行工具设置网络代理" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/terminal/" rel="tag">terminal</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-可视化接口管理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/01/%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2019-04-30T16:00:00.000Z" itemprop="datePublished">2019-05-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/01/%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/">可视化接口管理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>公司的接口文档都放在 wiki 平台上，时间长了，难以维护，同时没有一定的规范，后端的 swagger 代码生成的文档，缺乏灵活性，可读性也较差，前端开发人员不能直接更改接口文档，只能后端开发修改代码部署后才能看到 swagger 中最新的文档。</p>
<p>我们公司很多项目都是由前端来定义接口，前端其实是接口的消费者，根据产品设计的需要，主导制定接口文档，当然后端人员也是需要一起参与的，把关接口定义的合理性，约定好规范，才能正式开发。</p>
<h2 id="可视化接口管理平台"><a href="#可视化接口管理平台" class="headerlink" title="可视化接口管理平台"></a>可视化接口管理平台</h2><p>由于新启动了一个项目，前期准备的时候，我在公司的阿里云服务器上部署了一个开源的可视化接口管理平台 YApi，对于制定接口文档，及时更新维护，还能模拟数据，自动化测试，真的是十分方便。</p>
<p>YApi：旨在为开发、产品、测试人员提供更优雅的接口管理服务。可以帮助开发者轻松创建、发布、维护接口文档。</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>权限管理</li>
<li>可视化接口管理</li>
<li>Mock Server</li>
<li>自动化测试</li>
<li>数据导入</li>
<li>插件机制</li>
</ul>
<h2 id="工作流"><a href="#工作流" class="headerlink" title="工作流"></a>工作流</h2><p><img src="/assets/images/201904/yapi-flow.jpg" alt="yapi-flow"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://yapi.ymfe.org/">Yapi官网</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xiangrenya.github.io/2019/05/01/%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/" data-id="ckogpfhe60005kl9f1k2m1gwv" data-title="可视化接口管理" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/yApi/" rel="tag">yApi</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-接口定义规范 REST" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/01/%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83%20REST/" class="article-date">
  <time class="dt-published" datetime="2019-04-30T16:00:00.000Z" itemprop="datePublished">2019-05-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/01/%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83%20REST/">接口定义规范 REST</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>REST 全称 Representational State Transfer（表现层状态转换），是 Roy Thomas Fielding 博士于 2000 年在他的博士论文中提出来的一种软件构建风格。</p>
<h2 id="常见的错误"><a href="#常见的错误" class="headerlink" title="常见的错误"></a>常见的错误</h2><p>我们先来看几个不好的接口设计</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/getAllCustomers</span><br><span class="line">/createCustomer</span><br><span class="line">/updateCustomer</span><br><span class="line">/deleteCustomer</span><br></pre></td></tr></table></figure>

<h2 id="接口规范"><a href="#接口规范" class="headerlink" title="接口规范"></a>接口规范</h2><p>符合 REST 风格的接口，应该遵循 url 表示资源的定位，http method 请求方式表示对资源的操作，请求响应的状态码，表示请求的结果。</p>
<p>下面我们来举个简单的示例，来演示一下正确的接口定义规范</p>
<p>客户列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http://localhost:3000/customers</span><br><span class="line">Request Method: GET</span><br><span class="line">Status Code: 200</span><br></pre></td></tr></table></figure>

<p>过滤选项，可以通过 query 参数，追加在地址后面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http://localhost:3000/customers?userName=allen&amp;orderBy=createTime&amp;sortBy=desc&amp;pageNum=1&amp;pageSize=10</span><br></pre></td></tr></table></figure>

<p>创建客户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http://localhost:3000/customers</span><br><span class="line">Request Method: POST</span><br><span class="line">Status Code: 201</span><br></pre></td></tr></table></figure>

<p>单个客户详情</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http://localhost:3000/customers/:customerId</span><br><span class="line">Request Method: POST</span><br><span class="line">Status Code: 200</span><br></pre></td></tr></table></figure>

<p>更新客户信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http://localhost:3000/customers/:customerId</span><br><span class="line">Request Method: PUT</span><br><span class="line">Status Code: 200</span><br></pre></td></tr></table></figure>

<p>删除客户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http://localhost:3000/customers/:customerId</span><br><span class="line">Request Method: DELETE</span><br><span class="line">Status Code: 204</span><br></pre></td></tr></table></figure>

<p>多级资源：获取某个客户下的所有订单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http://localhost:3000/customers/:customerId/orders</span><br><span class="line">Request Method: GET</span><br><span class="line">Status Code: 200</span><br></pre></td></tr></table></figure>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul>
<li>使用 - 来分割单词让 url 可读性更好</li>
<li>使用 ? 用来过滤资源</li>
<li>避免使用多级 url</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 避免</span><br><span class="line">/customers/:customerId/orders/:orderId</span><br><span class="line"># 推荐</span><br><span class="line">/orders/:orderId</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/architecture/best-practices/api-design">API design</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xiangrenya.github.io/2019/05/01/%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83%20REST/" data-id="ckogpfhe8000fkl9fh0cq74w6" data-title="接口定义规范 REST" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/api/" rel="tag">api</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-远程登录服务器" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/19/%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="article-date">
  <time class="dt-published" datetime="2019-04-18T16:00:00.000Z" itemprop="datePublished">2019-04-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/19/%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E6%9C%8D%E5%8A%A1%E5%99%A8/">通过 ssh 工具远程登录服务器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>对于新安装的 CentOS 7 系统，默认情况下，我们是只能通过账号和密码登录的。问题主要是在我们每次登录都需要输入密码，会很麻烦，最好能一键登录。</p>
<p>为了能够实现免密登录，我们需要非对称加密过的公私密钥配对，来授权用户登录。</p>
<p>整体流程：通过 <code>ssh-keygen</code> 命令，在本地创建非对称加密的公私钥，然后目标服务器上，开启允许 ssh 远程登录，再将之前的生成的公钥粘贴到 <code>~/.ssh/authorized_keys</code> 文件中，最后重启 ssh 服务生效配置。</p>
<h2 id="创建密钥对"><a href="#创建密钥对" class="headerlink" title="创建密钥对"></a>创建密钥对</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &#x27;your_email@example.com&#x27;</span><br></pre></td></tr></table></figure>

<p>生成的密钥对，位于 <code>~/.ssh</code> 目录下，有两个文件</p>
<ul>
<li>id_rsa</li>
<li>id_rsa.pub</li>
</ul>
<h2 id="启用-ssh-远程登录"><a href="#启用-ssh-远程登录" class="headerlink" title="启用 ssh 远程登录"></a>启用 ssh 远程登录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过配置以下属性，允许 ssh 登录</span></span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 把本地的公钥粘贴到 authorized_keys 中</span></span><br><span class="line">vi ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<h2 id="重启-ssh-服务"><a href="#重启-ssh-服务" class="headerlink" title="重启 ssh 服务"></a>重启 ssh 服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure>
<h1 id="登录服务器"><a href="#登录服务器" class="headerlink" title="登录服务器"></a>登录服务器</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 通过密码登录</span><br><span class="line">ssh root@66.42.52.110</span><br><span class="line"># 通过私钥登录</span><br><span class="line">ssh -i ~/.ssh/id_rsa root@66.42.52.110</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://xiangrenya.github.io/2019/04/19/%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E6%9C%8D%E5%8A%A1%E5%99%A8/" data-id="ckogpfheb000lkl9f8foddm1t" data-title="通过 ssh 工具远程登录服务器" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-接口认证机制 JWT" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/12/25/%E6%8E%A5%E5%8F%A3%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%20JWT/" class="article-date">
  <time class="dt-published" datetime="2017-12-24T16:00:00.000Z" itemprop="datePublished">2017-12-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/12/25/%E6%8E%A5%E5%8F%A3%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%20JWT/">接口认证机制 JWT</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>现在大多数公司都是前后端完全分离，一个后端提供 rest api 服务，对应多个终端，如 ios, android, h5, web，在这种情况下，是无法使用 cookie + session 进行会话管理的，可以 JWT 进行用户认证鉴权，因为 JWT 是无状态的。</p>
<h2 id="JWT-是什么"><a href="#JWT-是什么" class="headerlink" title="JWT 是什么"></a>JWT 是什么</h2><p>JSON Web Token（JWT）是一个开放标准（RFC 7519），它定义了一种紧凑且独立的方式，可以在各方之间作为JSON对象安全地传输信息。此信息可以通过数字签名进行验证和信任。JWT可以使用密钥（使用 HMAC 算法）或使用 RSA 或 ECDSA 的公钥/私钥对进行签名。</p>
<h2 id="基于-JWT-认证的优势"><a href="#基于-JWT-认证的优势" class="headerlink" title="基于 JWT 认证的优势"></a>基于 JWT 认证的优势</h2><p>基于 JWT 的身份验证是无状态的，我们不将用户信息存在服务器或缓存中，减轻了服务器的压力；相比原始的 cookie + session 方式，JWT 更适合分布式系统的用户认证，绕开了传统的分布式 session一致性等问题；安全性高，不依赖 cookie，避免了 CSRF 攻击。</p>
<h2 id="JWT-有哪些组成"><a href="#JWT-有哪些组成" class="headerlink" title="JWT 有哪些组成"></a>JWT 有哪些组成</h2><p>一个 JWT 实际上就是一个字符串，它由三部分组成，头部、载荷与签名，之间以点拼接在一起，如 <code>xxxxx.yyyyy.zzzzz</code>。</p>
<ol>
<li>Header</li>
<li>Payload</li>
<li>Signature</li>
</ol>
<h3 id="头部-Header"><a href="#头部-Header" class="headerlink" title="头部 Header"></a>头部 Header</h3><p>Header有两个部分组成，包括token类型和hash算法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;JWT&#x27;</span>,</span><br><span class="line">  <span class="attr">alg</span>: <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，对 Header 进行 <code>Base64Url</code> 编码，作为 JWT 的第一个部分。</p>
<h3 id="载荷-Payload"><a href="#载荷-Payload" class="headerlink" title="载荷 Payload"></a>载荷 Payload</h3><p>Payload 由 JWT 的标准所定义的五个字段，如下：</p>
<ul>
<li>iss: 该JWT的签发者</li>
<li>sub: 该JWT所面向的用户</li>
<li>aud: 接收该JWT的一方</li>
<li>exp(expires): 什么时候过期，这里是一个Unix时间戳</li>
<li>iat(issued at): 在什么时候签发的</li>
</ul>
<p>我们可以在这里添加 B/S 之间要传递的信息，如 userId，切记不要写例如密码这样的敏感信息。然后对 Payload 进行 <code>Base64Url</code> 编码，作为 JWT 的第二个部分。</p>
<h3 id="签名-Signature"><a href="#签名-Signature" class="headerlink" title="签名 Signature"></a>签名 Signature</h3><p>生成签名，需要对用 <code>Base64Url</code> 编码过的报头、负载和密钥，进行算法加密，加密过程如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  base64UrlEncode(payload),</span><br><span class="line">  secret)</span><br></pre></td></tr></table></figure>

<p>通过签名可以验证 JWT 的有效性，如果被篡改过，就会返回401未授权的错误提示。</p>
<h2 id="JWT认证的实现过程"><a href="#JWT认证的实现过程" class="headerlink" title="JWT认证的实现过程"></a>JWT认证的实现过程</h2><p><img src="/assets/images/jwt-diagram.png" alt="image"></p>
<p>JWT 可以保存在 <code>localStorage</code> 中，每次请求在 http 请求时，在 Header 中加入 JWT 信息，格式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: token</span><br></pre></td></tr></table></figure>

<h2 id="JWT-在-Node-js-下的应用"><a href="#JWT-在-Node-js-下的应用" class="headerlink" title="JWT 在 Node.js 下的应用"></a>JWT 在 Node.js 下的应用</h2><p>首先在项目中安装所需的 <code>jsonwebtoken</code> 依赖包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -S jsonwebtoken</span><br></pre></td></tr></table></figure>

<p>签名和验证 <code>token</code> 语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 签名</span></span><br><span class="line">jwt.sign(payload, secret,  [options, callback])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证</span></span><br><span class="line">jwt.verify(token, secret, [options, callback])</span><br></pre></td></tr></table></figure>

<p>示例代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 签名</span></span><br><span class="line"><span class="built_in">exports</span>.signToken = <span class="function"><span class="params">userId</span> =&gt;</span> jwt.sign(&#123; userId &#125;, config.secret, &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;2h&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证</span></span><br><span class="line"><span class="built_in">exports</span>.verifyToken = <span class="function"><span class="params">token</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  jwt.verify(token, config.secret, <span class="function">(<span class="params">err, decoded</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) reject(err);</span><br><span class="line">    resolve(decoded.userId);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通过 token 验证中间件，保证每次 api 请求，都是带有效 token 的合法请求，并将传递的信息，如 userId 挂载在 req 对象中，然后参与到业务的处理当中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.authToken = <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> token = req.headers.authorization;</span><br><span class="line">  utils.verifyToken(token, config.secret)</span><br><span class="line">    .then(<span class="function"><span class="params">userId</span> =&gt;</span> &#123;</span><br><span class="line">      req.userId = userId;</span><br><span class="line">      next()</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> next(err));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="客户端处理-Token-的有效性"><a href="#客户端处理-Token-的有效性" class="headerlink" title="客户端处理 Token 的有效性"></a>客户端处理 Token 的有效性</h2><p>客户端每次发出 http 请求，可以通过 axios 全局配置响应拦截器，检测到 401 未授权时，清空本地存储中的 token，重定向至登录页。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">axios.interceptors.response.use(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.response.status === <span class="number">401</span>) &#123;</span><br><span class="line">      <span class="built_in">localStorage</span>.removeItem(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">      location.href = <span class="string">`/login?redirect=<span class="subst">$&#123;location.href&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error.response.data);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><ul>
<li><a target="_blank" rel="noopener" href="https://jwt.io/introduction">Introduction to JSON Web Tokens</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/auth0/node-jsonwebtoken">node-jsonwebtoken</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xiangrenya.github.io/2017/12/25/%E6%8E%A5%E5%8F%A3%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%20JWT/" data-id="ckogpfhe7000akl9f4scm30wc" data-title="接口认证机制 JWT" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li></ul>

    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96/">自动化</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/" rel="tag">api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oss/" rel="tag">oss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selenium/" rel="tag">selenium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/terminal/" rel="tag">terminal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yApi/" rel="tag">yApi</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/jwt/" style="font-size: 10px;">jwt</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/oss/" style="font-size: 10px;">oss</a> <a href="/tags/selenium/" style="font-size: 10px;">selenium</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/terminal/" style="font-size: 20px;">terminal</a> <a href="/tags/yApi/" style="font-size: 10px;">yApi</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/04/15/Selenium%20%E5%AE%9E%E7%8E%B0%20Web%20UI%20%E8%87%AA%E5%8A%A8%E5%8C%96/">Selenium 实现 Web UI 自动化</a>
          </li>
        
          <li>
            <a href="/2020/04/15/Python%20%E8%87%AA%E5%8A%A8%E4%B8%8A%E4%BC%A0%20CDN%20%E8%B5%84%E6%BA%90%E5%88%B0%20OSS%20Bucket/">Python 自动上传 CDN 资源到 OSS Bucket</a>
          </li>
        
          <li>
            <a href="/2020/04/15/%E6%AD%A6%E8%A3%85%E4%BD%A0%E7%9A%84%E7%BB%88%E7%AB%AF%20Terminal/">武装你的终端 Terminal</a>
          </li>
        
          <li>
            <a href="/2020/04/14/%E5%B8%B8%E7%94%A8%E7%9A%84%20SQL%20%E8%AF%AD%E5%8F%A5/">常用的 SQL 语句</a>
          </li>
        
          <li>
            <a href="/2020/04/13/Windows%20%E7%B3%BB%E7%BB%9F%E4%B8%8B%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5%20CentOS%207%20%E7%B3%BB%E7%BB%9F/">Windows 系统下远程桌面连接 CentOS 7 系统</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Allen<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>